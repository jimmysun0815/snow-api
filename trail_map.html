<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¿ Mammoth Mountain é›ªé“åœ°å›¾</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #f5f5f5;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .container {
            display: flex;
            height: calc(100vh - 80px);
        }

        .sidebar {
            width: 320px;
            background: white;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        #map {
            flex: 1;
        }

        .legend {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .legend h3 {
            font-size: 16px;
            margin-bottom: 12px;
            color: #333;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .legend-color {
            width: 30px;
            height: 4px;
            border-radius: 2px;
            margin-right: 10px;
        }

        .stats {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .stats h3 {
            font-size: 16px;
            margin-bottom: 12px;
            color: #333;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #666;
        }

        .stat-value {
            font-weight: bold;
            color: #333;
        }

        .controls {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .controls h3 {
            font-size: 16px;
            margin-bottom: 12px;
            color: #333;
        }

        .control-group {
            margin-bottom: 10px;
        }

        .control-group label {
            display: flex;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
            font-size: 14px;
        }

        .control-group label:hover {
            background: #f5f5f5;
        }

        .control-group input[type="checkbox"] {
            margin-right: 8px;
        }

        /* Leaflet å¼¹çª—æ ·å¼ */
        .leaflet-popup-content {
            margin: 12px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
        }

        .popup-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .popup-difficulty {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .difficulty-novice { background: #4ade80; color: white; }
        .difficulty-easy { background: #22c55e; color: white; }
        .difficulty-intermediate { background: #3b82f6; color: white; }
        .difficulty-advanced { background: #1e293b; color: white; }
        .difficulty-expert { background: #000000; color: white; }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: 200px;
            }
            #map {
                height: calc(100vh - 280px);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¿ Mammoth Mountain é›ªé“åœ°å›¾</h1>
        <p>äº¤äº’å¼é›ªé“å±•ç¤º Â· æ•°æ®æ¥æº: OpenStreetMap</p>
    </div>

    <div class="container">
        <div class="sidebar">
            <!-- å›¾ä¾‹ -->
            <div class="legend">
                <h3>ğŸ¨ é›ªé“éš¾åº¦</h3>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4ade80;"></div>
                    <span>ğŸŸ¢ åˆçº§ (Novice/Easy)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #3b82f6;"></div>
                    <span>ğŸ”µ ä¸­çº§ (Intermediate)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #1e293b;"></div>
                    <span>âš« é«˜çº§ (Advanced)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #000000;"></div>
                    <span>âš«âš« ä¸“å®¶ (Expert)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #9ca3af;"></div>
                    <span>âšª å…¶ä»–ç±»å‹</span>
                </div>
            </div>

            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="stats">
                <h3>ğŸ“Š é›ªé“ç»Ÿè®¡</h3>
                <div class="stat-item">
                    <span class="stat-label">æ€»é›ªé“æ•°</span>
                    <span class="stat-value" id="total-trails">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">åˆçº§é›ªé“</span>
                    <span class="stat-value" id="novice-trails">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ä¸­çº§é›ªé“</span>
                    <span class="stat-value" id="intermediate-trails">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">é«˜çº§é›ªé“</span>
                    <span class="stat-value" id="advanced-trails">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ä¸“å®¶é›ªé“</span>
                    <span class="stat-value" id="expert-trails">-</span>
                </div>
            </div>

            <!-- æ§åˆ¶é€‰é¡¹ -->
            <div class="controls">
                <h3>ğŸ›ï¸ æ˜¾ç¤ºæ§åˆ¶</h3>
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="show-novice" checked>
                        æ˜¾ç¤ºåˆçº§é›ªé“
                    </label>
                </div>
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="show-intermediate" checked>
                        æ˜¾ç¤ºä¸­çº§é›ªé“
                    </label>
                </div>
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="show-advanced" checked>
                        æ˜¾ç¤ºé«˜çº§é›ªé“
                    </label>
                </div>
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="show-expert" checked>
                        æ˜¾ç¤ºä¸“å®¶é›ªé“
                    </label>
                </div>
            </div>
        </div>

        <div id="map"></div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // åˆå§‹åŒ–åœ°å›¾
        const map = L.map('map').setView([37.6308, -119.0326], 14);

        // æ·»åŠ  OpenStreetMap åº•å›¾
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            maxZoom: 18
        }).addTo(map);

        // é›ªé“å›¾å±‚ç»„
        const trailLayers = {
            novice: L.layerGroup().addTo(map),
            easy: L.layerGroup().addTo(map),
            intermediate: L.layerGroup().addTo(map),
            advanced: L.layerGroup().addTo(map),
            expert: L.layerGroup().addTo(map),
            other: L.layerGroup().addTo(map)
        };

        // éš¾åº¦å¯¹åº”çš„é¢œè‰²å’Œå®½åº¦
        const difficultyStyles = {
            'novice': { color: '#4ade80', weight: 3 },
            'easy': { color: '#22c55e', weight: 3 },
            'intermediate': { color: '#3b82f6', weight: 3 },
            'advanced': { color: '#1e293b', weight: 3 },
            'expert': { color: '#000000', weight: 4 }
        };

        // ç»Ÿè®¡æ•°æ®
        const stats = {
            total: 0,
            novice: 0,
            easy: 0,
            intermediate: 0,
            advanced: 0,
            expert: 0
        };

        // åŠ è½½é›ªé“æ•°æ®
        fetch('data/mammoth_osm_trails.json')
            .then(response => response.json())
            .then(data => {
                const elements = data.elements || [];
                stats.total = elements.length;

                elements.forEach(element => {
                    const tags = element.tags || {};
                    const geometry = element.geometry || [];
                    
                    if (geometry.length < 2) return; // éœ€è¦è‡³å°‘2ä¸ªç‚¹

                    const name = tags.name || 'æœªå‘½åé›ªé“';
                    const difficulty = tags['piste:difficulty'] || 'unknown';
                    const pisteType = tags['piste:type'] || 'unknown';

                    // ç»Ÿè®¡
                    if (stats[difficulty] !== undefined) {
                        stats[difficulty]++;
                    }

                    // è½¬æ¢åæ ‡æ ¼å¼
                    const latlngs = geometry.map(point => [point.lat, point.lon]);

                    // ç¡®å®šæ ·å¼
                    let style = difficultyStyles[difficulty] || { color: '#9ca3af', weight: 2 };
                    
                    // åˆ›å»ºé›ªé“çº¿
                    const trail = L.polyline(latlngs, {
                        ...style,
                        opacity: 0.8
                    });

                    // æ·»åŠ å¼¹çª—
                    const difficultyLabel = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
                    const difficultyClass = `difficulty-${difficulty}`;
                    
                    trail.bindPopup(`
                        <div class="popup-title">${name}</div>
                        <div class="popup-difficulty ${difficultyClass}">${difficultyLabel}</div>
                        <div style="font-size: 13px; color: #666;">
                            ç±»å‹: ${pisteType}
                        </div>
                    `);

                    // æ·»åŠ åˆ°å¯¹åº”å›¾å±‚
                    const layerKey = ['novice', 'easy', 'intermediate', 'advanced', 'expert'].includes(difficulty) 
                        ? difficulty 
                        : 'other';
                    trail.addTo(trailLayers[layerKey]);
                });

                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                document.getElementById('total-trails').textContent = stats.total;
                document.getElementById('novice-trails').textContent = stats.novice + stats.easy;
                document.getElementById('intermediate-trails').textContent = stats.intermediate;
                document.getElementById('advanced-trails').textContent = stats.advanced;
                document.getElementById('expert-trails').textContent = stats.expert;

                console.log('âœ… åŠ è½½äº†', stats.total, 'æ¡é›ªé“');
            })
            .catch(error => {
                console.error('âŒ åŠ è½½é›ªé“æ•°æ®å¤±è´¥:', error);
                alert('åŠ è½½é›ªé“æ•°æ®å¤±è´¥ï¼Œè¯·ç¡®ä¿ data/mammoth_osm_trails.json æ–‡ä»¶å­˜åœ¨');
            });

        // æ§åˆ¶é€‰é¡¹äº‹ä»¶
        document.getElementById('show-novice').addEventListener('change', (e) => {
            if (e.target.checked) {
                map.addLayer(trailLayers.novice);
                map.addLayer(trailLayers.easy);
            } else {
                map.removeLayer(trailLayers.novice);
                map.removeLayer(trailLayers.easy);
            }
        });

        document.getElementById('show-intermediate').addEventListener('change', (e) => {
            if (e.target.checked) {
                map.addLayer(trailLayers.intermediate);
            } else {
                map.removeLayer(trailLayers.intermediate);
            }
        });

        document.getElementById('show-advanced').addEventListener('change', (e) => {
            if (e.target.checked) {
                map.addLayer(trailLayers.advanced);
            } else {
                map.removeLayer(trailLayers.advanced);
            }
        });

        document.getElementById('show-expert').addEventListener('change', (e) => {
            if (e.target.checked) {
                map.addLayer(trailLayers.expert);
            } else {
                map.removeLayer(trailLayers.expert);
            }
        });
    </script>
</body>
</html>


