# ğŸ”ï¸ ç”Ÿäº§ç¯å¢ƒé›ªé“æ•°æ®æ›´æ–°æŒ‡å—

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ æµ‹è¯•æ›´æ–°ï¼ˆæ¨èå…ˆæµ‹è¯•ï¼‰

åªæ›´æ–°å‰5ä¸ªé›ªåœºï¼Œç¡®ä¿ä¸€åˆ‡æ­£å¸¸ï¼š

```bash
cd backend-api
make update-trails-test
```

### 2ï¸âƒ£ æ›´æ–°æ‰€æœ‰é›ªåœº

æ›´æ–°æ‰€æœ‰309ä¸ªé›ªåœºçš„trailæ•°æ®ï¼š

```bash
make update-trails
```

**é¢„è®¡æ—¶é—´**: ~25-30åˆ†é’Ÿï¼ˆ309ä¸ªé›ªåœº Ã— 5ç§’é—´éš”ï¼‰

### 3ï¸âƒ£ æ›´æ–°å•ä¸ªé›ªåœº

åªæ›´æ–°æŸä¸ªç‰¹å®šé›ªåœºï¼š

```bash
make update-trails-single RESORT_ID=1
```

## ğŸ”§ è¯¦ç»†è¯´æ˜

### è„šæœ¬å·¥ä½œåŸç†

`update_prod_trails.py` è„šæœ¬ä¼šï¼š

1. **è‡ªåŠ¨è·å–ç”Ÿäº§ç¯å¢ƒé…ç½®**
   - ä» Terraform è¯»å– RDS å’Œ Redis ç«¯ç‚¹
   - ä» `terraform.tfvars` è¯»å–æ•°æ®åº“å¯†ç 
   
2. **éªŒè¯æ•°æ®åº“è¿æ¥**
   - æµ‹è¯•è¿æ¥ç”Ÿäº§æ•°æ®åº“
   - æ˜¾ç¤ºå½“å‰é›ªåœºæ•°é‡
   
3. **é‡‡é›†é›ªé“æ•°æ®**
   - ä½¿ç”¨ OpenStreetMap API è·å–é›ªé“ä¿¡æ¯
   - ä¿å­˜åˆ°ç”Ÿäº§æ•°æ®åº“
   - ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š

### å‘½ä»¤é€‰é¡¹

#### åŸºç¡€å‘½ä»¤
```bash
# æ›´æ–°æ‰€æœ‰é›ªåœº
python3 update_prod_trails.py

# åªæ›´æ–°å‰10ä¸ªé›ªåœºï¼ˆæµ‹è¯•ç”¨ï¼‰
python3 update_prod_trails.py --limit 10

# æ›´æ–°ç‰¹å®šé›ªåœº
python3 update_prod_trails.py --resort-id 1

# è·³è¿‡ç¡®è®¤æç¤º
python3 update_prod_trails.py --skip-verify
```

#### Makefile å¿«æ·å‘½ä»¤
```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
make help

# æµ‹è¯•æ›´æ–°ï¼ˆ5ä¸ªé›ªåœºï¼‰
make update-trails-test

# æ›´æ–°æ‰€æœ‰é›ªåœº
make update-trails

# æ›´æ–°å•ä¸ªé›ªåœº
make update-trails-single RESORT_ID=123
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç¯å¢ƒè¦æ±‚

ç¡®ä¿å·²å®‰è£…å¿…è¦ä¾èµ–ï¼š
```bash
pip install -r requirements.txt
```

### 2. AWS é…ç½®

éœ€è¦é…ç½® AWS CLI profileï¼ˆppï¼‰ï¼š
```bash
aws configure --profile pp
```

### 3. Terraform çŠ¶æ€

ç¡®ä¿ Terraform çŠ¶æ€æ˜¯æœ€æ–°çš„ï¼š
```bash
cd terraform
terraform plan  # æ£€æŸ¥çŠ¶æ€
```

### 4. ç½‘ç»œè®¿é—®

è„šæœ¬éœ€è¦ï¼š
- è®¿é—® AWS RDSï¼ˆé€šè¿‡ VPN æˆ–å ¡å’æœºï¼‰
- è®¿é—® OpenStreetMap API

### 5. æ—¶é—´å’Œé™æµ

- æ¯ä¸ªé›ªåœºé‡‡é›†é—´éš” **5ç§’**ï¼ˆé¿å… OSM API é™æµï¼‰
- 309ä¸ªé›ªåœºé¢„è®¡ **25-30åˆ†é’Ÿ**
- å»ºè®®åœ¨éé«˜å³°æ—¶æ®µè¿è¡Œ

## ğŸ“Š æŸ¥çœ‹ç»“æœ

é‡‡é›†å®Œæˆåä¼šç”ŸæˆæŠ¥å‘Šï¼š

```bash
# JSON æŠ¥å‘Š
cat data/trails_report.json

# HTML æŠ¥å‘Šï¼ˆæ›´ç›´è§‚ï¼‰
open data/trails_report.html
```

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ— æ³•è¿æ¥æ•°æ®åº“

**ç—‡çŠ¶**: `æ— æ³•è¿æ¥åˆ°ç”Ÿäº§æ•°æ®åº“`

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ VPN è¿æ¥
2. éªŒè¯ RDS å®‰å…¨ç»„é…ç½®
3. ç¡®è®¤æ•°æ®åº“å¯†ç æ­£ç¡®

```bash
# æ‰‹åŠ¨æµ‹è¯•è¿æ¥
psql -h <RDSç«¯ç‚¹> -U app -d snow
```

### é—®é¢˜2: Terraform è¾“å‡ºå¤±è´¥

**ç—‡çŠ¶**: `è·å– Terraform è¾“å‡ºå¤±è´¥`

**è§£å†³æ–¹æ¡ˆ**:
1. åˆ‡æ¢åˆ° terraform ç›®å½•
2. è¿è¡Œ `terraform refresh`
3. æ£€æŸ¥ Terraform çŠ¶æ€

```bash
cd terraform
terraform output
```

### é—®é¢˜3: OSM API é™æµ

**ç—‡çŠ¶**: é‡‡é›†æ—¶å‡ºç° 429 é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. å¢åŠ ç­‰å¾…é—´éš”ï¼ˆç¼–è¾‘ `collect_trails.py`ï¼‰
2. åˆ†æ‰¹æ¬¡é‡‡é›†

```bash
# åˆ†æ‰¹é‡‡é›†
python3 update_prod_trails.py --limit 50
# ç­‰å¾…å‡ åˆ†é’Ÿåç»§ç»­ä¸‹ä¸€æ‰¹
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å¢é‡æ›´æ–°ç­–ç•¥

å¦‚æœåªéœ€è¦æ›´æ–°éƒ¨åˆ†é›ªåœºï¼š

```bash
# æ›´æ–°ç‰¹å®šIDèŒƒå›´
for id in {1..50}; do
    python3 update_prod_trails.py --resort-id $id --skip-verify
    sleep 5
done
```

### 2. å®šæ—¶æ›´æ–°

å¯ä»¥è®¾ç½® cron ä»»åŠ¡å®šæœŸæ›´æ–°ï¼š

```bash
# æ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹æ›´æ–°
0 3 * * 0 cd /path/to/backend-api && python3 update_prod_trails.py --skip-verify
```

### 3. ç›‘æ§å’Œå‘Šè­¦

æŸ¥çœ‹é‡‡é›†æ—¥å¿—ï¼š
```bash
tail -f data/trails_report.json
```

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚é‡é—®é¢˜ï¼ŒæŸ¥çœ‹ï¼š
1. é‡‡é›†æŠ¥å‘Š: `data/trails_report.html`
2. æ•°æ®åº“æ—¥å¿—
3. AWS CloudWatch æ—¥å¿—

---

**ç¥é‡‡é›†é¡ºåˆ©ï¼** ğŸ¿â›·ï¸

